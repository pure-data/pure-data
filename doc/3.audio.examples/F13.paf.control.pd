#N canvas 484 38 626 796 12;
#X declare -stdpath ./;
#X obj 116 552 cos~;
#X obj 116 493 *~;
#X obj 156 552 cos~;
#X obj 229 503 wrap~;
#X obj 193 503 -~;
#X obj 156 529 +~;
#X obj 156 594 -~;
#X obj 186 625 *~;
#X obj 150 630 +~;
#X obj 193 471 samphold~;
#X floatatom 193 264 4 0 127 0 - \$0-center-freq - 0;
#X obj 193 338 line~;
#X obj 193 314 pack 0 50;
#X obj 116 414 phasor~;
#X floatatom 116 310 4 0 127 0 - \$0-fundamental - 0;
#X floatatom 354 332 4 0 127 0 - \$0-bandwidth - 0;
#X obj 354 403 line~;
#X obj 336 539 *~;
#X obj 354 380 pack 0 50;
#X obj 291 508 cos~;
#X obj 291 483 -~ 0.25;
#X obj 336 565 +~ 100;
#X obj 336 588 tabread4~ bell-curve;
#X obj 181 663 *~;
#X text 346 615 waveshaper;
#X obj 116 334 mtof;
#X obj 211 366 expr 1/$f1;
#X obj 193 290 mtof;
#X obj 193 390 *~;
#X obj 354 354 mtof;
#X obj 354 439 *~;
#X obj 354 463 *~ 25;
#X text 394 438 divide by fundamental;
#X text 412 462 range for table;
#X text 391 552 offset to middle of table, f 16;
#X text 199 410 C.F. relative;
#X text 200 426 to fundamental;
#X text 217 661 ring mod;
#X obj 181 700 output~;
#X obj 291 458 *~ 0.5;
#X text 23 66 The more "natural" units for describing a formant might be center frequency and bandwidth \, so that you can change the fundamental without having the formant shift up and down in parallel. Here all three frequencies are expressed in MIDI units. The bandwidth and center frequency have to be divided by the fundamental (the expr 1/$f1 takes its reciprocal and two [*~] objects finish the division.), f 81;
#X text 23 154 Here we take a somewhat lax approach to sampholding the center frequency control. The frequency itself changes instantly \, but the center/fundamental frequency ratio waits for the next period. This gives a slight "chirp" if the fundamental is abruptly raised a couple of octaves. There's no easy way using Pd's built-in primitives to avoid this. Note however that there's a [paf~] extern available which solves this problem better and \, moreover \, runs much faster., f 81;
#X text 78 272 fundamental (MIDI units), f 12;
#X obj 42 19 cnv 5 5 25 empty empty Changing\ PAF\ Controls\ to\ Natural\ Units 15 13 0 16 #dfdfdf #202020 0;
#N canvas 270 258 499 360 table 0;
#X obj 74 62 t b b;
#X obj 152 131 f;
#X obj 190 131 + 1;
#X msg 170 101 0;
#X obj 74 91 until;
#X obj 152 166 t f f;
#X obj 54 281 tabwrite bell-curve;
#X obj 50 245 expr exp(-$f1*$f1);
#X obj 86 157 sel 199;
#X obj 50 216 expr ($f1-100)/25;
#N canvas 0 0 450 300 (subpatch) 0;
#X array bell-curve 200 float 1;
#A 0 1.12535e-07 1.54727e-07 2.12059e-07 2.89706e-07 3.94519e-07 5.35535e-07 7.24633e-07 9.77371e-07 1.31404e-06 1.76105e-06 2.35258e-06 3.13275e-06 4.15832e-06 5.50199e-06 7.25659e-06 9.54016e-06 1.25023e-05 1.63317e-05 2.1266e-05 2.76026e-05 3.57128e-05 4.60584e-05 5.92113e-05 7.58768e-05 9.69224e-05 0.00012341 0.000156634 0.000198167 0.000249912 0.000314163 0.000393669 0.000491721 0.000612231 0.000759842 0.000940028 0.00115923 0.00142498 0.00174605 0.00213263 0.00259648 0.00315111 0.00381201 0.00459678 0.0055254 0.0066204 0.00790705 0.0094136 0.0111714 0.013215 0.0155826 0.0183156 0.0214592 0.0250621 0.0291763 0.0338573 0.0391639 0.0451575 0.0519019 0.0594631 0.0679081 0.0773047 0.0877205 0.0992216 0.111872 0.125732 0.140858 0.1573 0.1751 0.194291 0.214896 0.236928 0.260383 0.285247 0.311486 0.339053 0.367879 0.397882 0.428956 0.46098 0.493812 0.527292 0.561244 0.595473 0.62977 0.663916 0.697676 0.730811 0.763074 0.794216 0.823987 0.852144 0.878447 0.902668 0.924595 0.944027 0.960789 0.974725 0.985703 0.99362 0.998401 1 0.998401 0.99362 0.985703 0.974725 0.960789 0.944027 0.924595 0.902668 0.878447 0.852144 0.823987 0.794216 0.763074 0.730811 0.697676 0.663916 0.62977 0.595473 0.561244 0.527292 0.493812 0.46098 0.428956 0.397882 0.367879 0.339053 0.311486 0.285247 0.260383 0.236928 0.214896 0.194291 0.1751 0.1573 0.140858 0.125732 0.111872 0.0992216 0.0877205 0.0773047 0.0679081 0.0594631 0.0519019 0.0451575 0.0391639 0.0338573 0.0291763 0.0250621 0.0214592 0.0183156 0.0155826 0.013215 0.0111714 0.0094136 0.00790705 0.0066204 0.0055254 0.00459678 0.00381201 0.00315111 0.00259648 0.00213263 0.00174605 0.00142498 0.00115923 0.000940028 0.000759842 0.000612231 0.000491721 0.000393669 0.000314163 0.000249912 0.000198167 0.000156634 0.00012341 9.69224e-05 7.58768e-05 5.92113e-05 4.60584e-05 3.57128e-05 2.76026e-05 2.1266e-05 1.63317e-05 1.25023e-05 9.54016e-06 7.25659e-06 5.50199e-06 4.15832e-06 3.13275e-06 2.35258e-06 1.76105e-06 1.31404e-06 9.77371e-07 7.24633e-07 5.35535e-07 3.94519e-07 2.89706e-07 2.12059e-07 1.54727e-07;
#X coords 0 1 199 0 200 140 1;
#X restore 253 106 graph;
#X obj 74 26 bng 19 250 50 0 empty empty empty 0 -10 0 12 #dfdfdf #000000 #000000;
#X text 100 25 <- remake the table;
#X connect 0 0 4 0;
#X connect 0 1 3 0;
#X connect 1 0 2 0;
#X connect 1 0 5 0;
#X connect 1 0 8 0;
#X connect 2 0 1 1;
#X connect 3 0 1 1;
#X connect 4 0 1 0;
#X connect 5 0 9 0;
#X connect 5 1 6 1;
#X connect 7 0 6 0;
#X connect 8 0 4 1;
#X connect 9 0 7 0;
#X connect 11 0 0 0;
#X restore 451 705 pd table;
#N canvas 238 316 365 358 init 0;
#X obj 125 294 declare -stdpath ./;
#X obj 131 97 loadbang;
#X text 81 28 This subpatch initializes the patch and loads a value in the number boxes., f 29;
#X obj 131 126 bng 19 250 50 0 empty empty empty 0 -10 0 12 #dfdfdf #000000 #000000;
#X obj 131 153 f \$0;
#X msg 131 183 \; \$1-fundamental 48 \; \$1-center-freq 60 \; \$1-bandwidth 72;
#X connect 1 0 3 0;
#X connect 3 0 4 0;
#X connect 4 0 5 0;
#X restore 372 705 pd init;
#X text 227 264 center freq. (also MIDI);
#X text 393 332 bandwidth (MIDI);
#X connect 0 0 6 1;
#X connect 0 0 8 0;
#X connect 1 0 5 0;
#X connect 1 0 0 0;
#X connect 2 0 6 0;
#X connect 3 0 4 1;
#X connect 3 0 7 1;
#X connect 4 0 1 1;
#X connect 5 0 2 0;
#X connect 6 0 7 0;
#X connect 7 0 8 1;
#X connect 8 0 23 0;
#X connect 9 0 4 0;
#X connect 9 0 3 0;
#X connect 10 0 27 0;
#X connect 11 0 28 0;
#X connect 12 0 11 0;
#X connect 13 0 9 1;
#X connect 13 0 1 0;
#X connect 13 0 5 1;
#X connect 13 0 39 0;
#X connect 14 0 25 0;
#X connect 15 0 29 0;
#X connect 16 0 30 0;
#X connect 17 0 21 0;
#X connect 18 0 16 0;
#X connect 19 0 17 0;
#X connect 20 0 19 0;
#X connect 21 0 22 0;
#X connect 22 0 23 1;
#X connect 23 0 38 0;
#X connect 25 0 26 0;
#X connect 25 0 13 0;
#X connect 26 0 28 1;
#X connect 26 0 30 1;
#X connect 27 0 12 0;
#X connect 28 0 9 0;
#X connect 29 0 18 0;
#X connect 30 0 31 0;
#X connect 31 0 17 1;
#X connect 39 0 20 0;
